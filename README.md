# Codepage Repair

**ВНИМАНИЕ! Это не безобидная программа!**

**Все, что Вы делаете - только на Ваш страх и риск.**

**Автор не несет ответственности за потерянное Вами время.**

**Есть реальный риск, что после выполнения скрипта Ваша система может не загрузиться, особенно если не следовать Инструкции!**

**Система восстановления Windows работать не будет.**

**Прежде чем запускать скрипт, настоятельно рекомендую убедиться:**
-  в наличии установочного диска или LiveCD;
- наличии у Вас навыков загрузки из под него с запуском Проводника. См. спойлер ниже.
- распечатайте инструкцию ниже:

## Как восстановить систему после сбоя
Загрузитесь с диска. Если это установочный диск, Вам нужно выбрать пункт "Варианты восстановления" -> командная строка, ввести слово notepad, нажать ENTER.
Откроется блокнот. Нажмите Файл -> Открыть.
1. В этом окне перейдите в каталог со скачанной программой RU_Codepage_Repair, зайдите в папку Backup.
Файлы:
- CodePage_LM.reg
- Console_CU.reg
- Font_LM.reg
- International_CU.reg
с каждым по очереди правой кнопкой мыши выбирайте пункт "Слияние".
На вопросы отвечайте утвердительно.
2. Все остальные файлы вида C_<номер>.NLS скопируйте в папку Буква диска\Windows\System32 с заменой.
Перезагрузите систему.


## Что делает скрипт?

* Восстанавливает русские шрифты после сбоя;
* Сброс настроек консоли, например, впоследствие некорректного завершения работы ComboFix.
* Замена файлов NLS на эталонные.
* Замена ключей реестра, связанных с международными языковыми настройками, на эталонные.

Совместимость: от Windows XP / Vista / 7 / 8 / 8.1 *
* только русские локализованные версии, или системы с установленным русским MUI
(проверка локализации встроена в скрипт).

## Использование
1. Распаковать архив.
2. Запустить файл **RU_Codepage_Repair.cmd**
3. Следовать инструкциям:
- Создать контрольную точку восстановления системы.
- Запастись диском восстановления (LiveCD).
- Временно отключить антивирусное ПО.
4. Продолжить выполнение скрипта нажатием кнопки ENTER.
5. На предложение о перезагрузке ответьте Y, нажмите ENTER.

## Подробнее: что делает утилита
1. Создается резервная копия веток реестра:
 - HKCU\Console
 - HKCU\Control Panel\International
 - HKLM\SYSTEM\CurrentControlSet\Control\Nls\CodePage
 - HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\FontSubstitutes
а также файлов **C*.NLS** из Windows\system32
2. В реестр импортируется твик реестра для оригинальных настроек международных стандартов и кодовой страницы.
3. Производится замена файлов NLS и веток реестра на "чистые" из оригинального дистрибутива (уже включены в архив - папка "original").
4. Восстанавливается владелец и исходные права на файлы.
В процессе работы оригинальные NLS переименовуются в NLS_, т.к. все еще используются системой.
5. После перезагрузки системы происходит очистка в системном каталоге резервных копий *.NLS_ из-под ключа реестра RunOnceEx.

## Режим отката изменений
Скрипт делает резервное копирование заменяемых файлов и настроек в подпапку Backup.
Если что-то пошло не так, Вы можете сделать откат через установочный диск (подробнее - читайте пункт выше "**Как восстановить систему после сбоя**").
